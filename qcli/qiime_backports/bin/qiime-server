#!/usr/bin/env python
from sys import argv, exit, stderr
import BaseHTTPServer
import CGIHTTPServer

## This line enables CGI error reporting
import cgitb; cgitb.enable()

from qcli.exception import IncompetentUserError

__author__ = "Jai Ram Rideout"
__copyright__ = "Copyright 2013, The QIIME Project"
__credits__ = ["Greg Caporaso", "Daniel McDonald", "Doug Wendel",
               "Jai Ram Rideout"]
__license__ = "BSD"
__version__ = "0.1.0-dev"
__maintainer__ = "Jai Ram Rideout"
__email__ = "jai.rideout@gmail.com"

PORT=8000

def usage():
    print "usage: qiime-server [<port>]"
    exit(0)


if __name__ == '__main__':
    if len(argv) > 2:
        usage()
    elif len(argv) == 2:
        try:
            port = int(argv[1])
        except:
            raise IncompetentUserError("Ports are *NUMBERS*!")
    else:
        port = PORT

    # Taken from http://pointlessprogramming.wordpress.com/2011/02/13/python-cgi-tutorial-1/
    server = BaseHTTPServer.HTTPServer
    handler = CGIHTTPServer.CGIHTTPRequestHandler
    server_address = ('', port)
    #handler.cgi_directories = ['/']
    httpd = server(server_address, handler)

    print "Serving at port", port
    httpd.serve_forever()
